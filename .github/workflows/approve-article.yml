name: ‚úÖ Artikel Freigeben

on:
  workflow_dispatch:
    inputs:
      make_featured:
        description: 'Als Featured Artikel setzen?'
        required: true
        default: 'no'
        type: choice
        options:
          - 'no'
          - 'yes'

jobs:
  approve:
    runs-on: ubuntu-latest
    steps:
      - name: Checkout
        uses: actions/checkout@v4
      
      - name: Approve Pending Article
        run: |
          node -e "
          const fs = require('fs');
          const data = JSON.parse(fs.readFileSync('data/articles.json', 'utf8'));
          
          if (!data.pending || data.pending.length === 0) {
            console.log('‚ùå Keine Artikel in pending!');
            process.exit(0);
          }
          
          const article = data.pending.shift();
          article.status = 'published';
          
          const makeFeatured = '${{ github.event.inputs.make_featured }}' === 'yes';
          
          if (makeFeatured) {
            if (data.featured) {
              data.articles.unshift(data.featured);
              console.log('üì¶ Alter Featured verschoben: ' + data.featured.title);
            }
            data.featured = article;
            console.log('‚≠ê Neuer Featured Artikel: ' + article.title);
          } else {
            data.articles.unshift(article);
            console.log('‚úÖ Artikel freigegeben: ' + article.title);
          }
          
          data.meta.totalArticles = 1 + data.articles.length;
          
          fs.writeFileSync('data/articles.json', JSON.stringify(data, null, 2));
          console.log('üíæ articles.json gespeichert');
          "
      
      - name: Commit Changes
        run: |
          git config user.name "github-actions[bot]"
          git config user.email "github-actions[bot]@users.noreply.github.com"
          git add data/articles.json
          git commit -m "‚úÖ Artikel freigegeben"
          git push
